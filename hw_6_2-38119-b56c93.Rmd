---
title: "ДЗ 6.2. Предиктивная аналитика и статистические выводы"
author: "Катин Алексей"
date: "12 03 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
1. Если кинуть игральную кость шесть раз, какова вероятность что хоть раз выпадет 6?

*Складывать вероятности для шести исходов сложно, но формулировка «хотя бы раз» позволяет поставить задачу так: «какова вероятность, что ни разу не выпадет 6», т. е. рассчитать вероятность события, противоположного заданному.*

```{r 01_1}
1- (5/6)^6
```

*Проверим симуляцией:*

```{r 01_2}
set.seed(1998)
any_six <- replicate(
  10000,
  any(sample(1:6, 6, replace = TRUE) == 6)
)
mean(any_six)
```

**Ответ:** ≈ *0,665*

2. Тест Minnesota Paper Form Board (RMPFB) измеряет невербальные способности решения проблем, относящихся к пространственному мышлению. Тест RMPFB разработан таким образом, что результаты теста могут быть смоделированы с помощью нормального распределения со средним значением 43 балла и стандартным отклонением 8 баллов.
а) Какая доля всех тестируемых будет иметь балл RMPFB выше 50?
б) Какая доля всех прошедших тестирование будет иметь оценку RMPFB ниже 30 баллов?
в) Какая оценка теста для первого квантиля? (у 25% участников оценка ниже). Значение Z для 25% -0.675.

*а) Вероятность `P(X > x)` вычисляется функцией `pnorm()` с аргументом `lower.tail = FALSE`*

```{r 02_1_1}
pnorm(50, mean = 43, sd = 8, lower.tail = FALSE)
```

*Проверим симуляцией:*

```{r 02_1_2}
set.seed(1998)
over50 <- replicate(
  10000,
  mean(rnorm(10000, 43, 8) > 50)
)
mean(over50)
```

*б) Вероятность `P(X < x)` можно вычислить, отняв от вероятности P(X ≤ x) вероятность P(X = x):*

```{r 02_2_1}
pnorm(30, mean = 43, sd = 8) - dnorm(30, mean = 43, sd = 8)

# Но почему тогда результат — вероятность P(X < 30) ниже вероятности P(X <= 29)??
# pnorm(29, mean = 43, sd = 8)
# [1] 0.04005916
```

*Проверим симуляцией:*

```{r 02_2_2}
set.seed(1998)
under30 <- replicate(
  10000,
  mean(rnorm(10000, 43, 8) < 30)
)
mean(under30)
```

*Значит, верным расчетом является* `r pnorm(30, mean = 43, sd = 8)`

*в) Квантиль 25 перцентили вычислим через готовую функцию `qnorm()` и через значение Z (среднее плюс Z стандартных отклонений):*

```{r 02_3}
# На всякий случай уточним значение Z для стандартного нормального распределения
qnorm(.25)

43 + 8 * -0.6745
qnorm(.25, mean = 43, sd = 8)
```

3. Следующий вопрос был задан более чем 50 000 учащимся в рамках стандартизированного статистического теста: «Верно или неверно: р-величина - это вероятность того, что нулевая гипотеза верна.» Для случайной выборки из 400 студентов, которые прошли тестирование, 175 ответили «истина», а 225 ответили «ложь». Гадают ли студенты на ответ или нет? Проведите соответствующий тест гипотезы, чтобы ответить на этот вопрос.

*Нулевая гипотеза (H~0~): вероятность правильного ответа — 50%. Альтернативная гипотеза (H~A~): вероятность правильного ответа не равна 50%. «Успехом» назовем правильный ответ на вопрос. Правильно ответили 225 из 400:*

```{r 03_1}
(U <- (225/400 - 0.5) * sqrt(400) / sqrt(0.5 * 0.5))
# 1 - (pnorm(U) - pnorm(-U))
U > 1.96
```

```{r 03_2}
pbinom(224, 400, .5, lower.tail = F) + pbinom(175, 400, .5)
```

```{r 03_3}
(the_test <- binom.test(225, n = 400, p = 0.5))
```

*Симуляция:*

```{r 03_4}
set.seed(1998)
right <- rbinom(10000, size = 400, prob = .5)
mean(right >= 225 | right <= 175) # Двусторонняя вероятность
```

**Ответ:** *Результаты теста значимы на уровне 5%: вероятность правильного ответа не равна 0,5. Студенты не гадают при ответе на указанный вопрос.*

4. Большая бухгалтерская компания недавно отобрала 100 человек для участия в программе обучения управлению. Из них 76 мужчин и 24 женщины. Компания утверждает, что она выбрала 100 человек наугад из числа подходящих сотрудников, 800 женщин и 1200 мужчин. Соответствует ли выборка утверждению компании, или женщины составляют значительно меньшую долю отобранных для программы обучения, чем доля подходящих под условия программы женщин?

*Это вопрос на оценку адекватности модели методом ${\chi}^2$*

```{r 04_1}
# Можно рассчитать ожидаемые вероятности для мужчин и женщин
# (mfpbs <- c(1200, 800) / (1200 + 800))
# Но в этом нет необходимости благодаря гибкости функции chisq.test(), которая
# может принимать на вход количества и сама рассчитывать ожидаемые пропорции
(the_test <- chisq.test(c(76, 24), p = c(1200, 800), rescale.p = TRUE))
the_test$expected
the_test$stdres
```

5. В группе из 62 мужчин, подвергшихся стрессовой ситуации, среднее число ударов сердца в минуту составило 126, а стандартное отклонение - 4.
а) Построить и интерпретировать 95% -ный доверительный интервал для матожидания сердечного ритма в минуту.
б) Проверить гипотезу о том, что среднее значение составляет 118 ударов в минуту, в сравнении с альтернативой, согласно которой матожидание сердечных сокращений превышает 118 ударов в минуту.

6. Две команды Вашингтон Капиталз и Детройт ред Уингз играют серию плейофф из семи игр. Вашингтон - команда получше, и с вероятностью 60% выигрывает в каждой игре. 
а) Какова вероятность того, что Детроит выиграют хотя бы одну игру?
б) Создайте симуляцию Монте-Карло, чтобы подтвердить свой ответ. Используйте 10000 симуляций. 
Используйте следующий код для генерации результатов первых четырех игр:
detroit_wins <- sample(c(0,1), 4, replace = TRUE, prob = c(0.6, 0.4))